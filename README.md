# 🍪 CookieSyncer – 通用 Cookie/TOKEN 推送助手

跨站点、跨设备的 Cookie/TOKEN 自动续期与推送助手，让登录状态永远在线。

## 🚨 重要提醒：无需构建，开箱即用！

✅ **立即安装**：下载后直接安装到Chrome，无需任何构建步骤！
✅ **零配置**：无需安装Node.js、无需运行命令、无需配置环境
✅ **完整功能**：所有功能都已实现，包含日志、Cookie管理等高级特性

现代化TypeScript版本仅供学习参考，不影响当前版本的使用！

## ⚡ 快速安装（3分钟）

### 1. 下载项目
将整个 `CookieSyncer` 文件夹下载到电脑

### 2. 安装到Chrome
```bash
1. 打开: chrome://extensions/
2. 启用右上角"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择CookieSyncer文件夹
5. ✅ 安装完成！
```

### 3. 开始使用
```bash
1. 点击工具栏🍪图标
2. 点击"⚙️ 设置"添加域名
3. 输入 github.com 并添加
4. 点击编辑设置60分钟频率
5. ✅ 配置完成，享受自动化服务！
```

## ✨ 功能特色

- **🔧 域名管理**：支持手动添加域名配置，灵活控制推送范围
- **⏰ 定时任务**：基于 Chrome Alarms API，支持分钟级定时推送
- **🔄 多层续期策略**：
  - Fetch 策略：轻量级 HTTP 请求带 Cookie 访问
  - Tab 策略：后台静默打开页面触发续期逻辑
  - Script 策略：注入脚本模拟用户交互
- **🍪 Cookie 获取**：支持获取 HttpOnly Cookie，支持字段过滤
- **📊 推送日志**：完整的推送历史记录和状态追踪
- **🔍 Cookie查看器**：独立页面查看和管理域名Cookie
- **⚙️ 灵活配置**：支持自定义推送频率、续期策略、Cookie字段选择
- **🎨 美观界面**：现代化的弹窗和选项页面设计
- **🔒 安全隐私**：仅操作用户手动添加的域名，避免全局抓取

## 📁 项目结构

```
CookieSyncer/
├── manifest.json          # 扩展配置文件（修复图标问题）
├── background.js          # 后台服务工作线程（增强消息处理和日志）
├── popup.html             # 弹窗页面（添加新功能按钮）
├── popup.js               # 弹窗逻辑（添加页面跳转功能）
├── options.html           # 配置页面（添加编辑模态框）
├── options.js             # 配置逻辑（完善编辑和显示功能）
├── logs.html              # 推送日志页面（完整筛选和统计）
├── logs.js                # 日志页面逻辑（支持导出和管理）
├── cookies.html           # Cookie查看器页面（域名列表展示）
├── cookies.js             # Cookie查看器逻辑（自动加载所有域名）
├── js/
│   └── domain-manager.js  # 域名管理器（添加日志功能）
├── icons/
│   └── icon.svg           # 扩展图标（SVG格式）
└── README.md              # 更新文档和测试指南
```

## 🚀 安装使用

### 📥 下载项目

1. **下载项目文件**：将整个 `CookieSyncer` 文件夹下载到您的电脑
2. **确保文件完整**：确认所有文件都在同一个目录下

### ⚠️ 重要说明：无需构建！

**当前版本是纯JavaScript实现，无需任何构建步骤！**

✅ **直接安装使用**：下载后立即安装到Chrome
✅ **零配置运行**：无需安装Node.js或其他工具
✅ **完整功能**：所有功能都已实现并可用

现代化TypeScript版本仅供学习和长期维护参考，无需构建即可享受完整功能！

**文件结构确认**：
```
CookieSyncer/
├── manifest.json     ✅ 扩展配置文件
├── background.js     ✅ 后台服务（核心功能）
├── popup.html        ✅ 弹窗界面
├── options.html      ✅ 配置页面
├── logs.html         ✅ 日志页面
├── cookies.html      ✅ Cookie查看器
├── js/               ✅ JavaScript文件
│   ├── domain-manager.js  ✅ 域名管理器
│   ├── options.js         ✅ 配置逻辑
│   ├── popup.js           ✅ 弹窗逻辑
│   ├── logs.js            ✅ 日志逻辑
│   └── cookies.js         ✅ Cookie查看器逻辑
├── icons/
│   └── icon.svg      ✅ 扩展图标
└── README.md         ✅ 说明文档
```

### ⚡ 快速安装（3分钟完成）

#### 步骤1：打开Chrome扩展管理
1. 启动Chrome浏览器
2. 在地址栏输入：**`chrome://extensions/`**
3. 按回车键打开扩展管理页面

#### 步骤2：启用开发者模式
1. 在扩展管理页面找到右上角的"开发者模式"
2. 点击开关启用（开关变蓝）

#### 步骤3：加载扩展程序
1. 点击页面左上角的"**加载已解压的扩展程序**"按钮
2. 在弹出的文件对话框中选择 `CookieSyncer` 文件夹
3. 点击"确定"完成安装

#### 步骤4：验证安装成功
1. 扩展列表中出现"CookieSyncer – 通用 Cookie/TOKEN 推送助手"
2. 确保扩展已启用（右侧开关为蓝色）
3. Chrome工具栏出现CookieSyncer图标（🍪）

### 🎯 立即开始使用

#### 第一步：添加测试域名
1. **点击扩展图标**（工具栏中的🍪图标）打开弹窗
2. **点击"⚙️ 设置"**进入配置页面
3. **添加域名**：
   - 在输入框输入：`httpbin.org`（用于测试）
   - 点击"添加域名"按钮
4. **配置域名**：
   - 点击域名后的"编辑"按钮
   - 设置推送频率：`60`分钟
   - 选择续期策略：`Fetch请求`
   - 点击"保存配置"

#### 第二步：测试基本功能
1. **查看弹窗状态**：点击扩展图标，查看域名状态显示
2. **查看日志**：点击"📊 日志"查看推送历史
3. **查看Cookie**：点击"🍪 Cookie"查看域名Cookie概况
4. **等待自动推送**：扩展会根据配置自动执行推送

#### 第三步：添加实际域名
1. **替换为实际域名**：如 `github.com`、`stackoverflow.com` 等
2. **调整配置**：根据网站特点调整推送频率和策略
3. **测试续期**：确认Cookie能够正确续期和推送

### 📱 界面功能概览

#### 扩展弹窗（主界面）
```
🍪 CookieSyncer
   智能Cookie推送助手

📍 当前页面
   github.com
   https://github.com/username

🔧 域名状态
   [域名列表和状态显示]

⚡ 快速操作
   [🔄 推送全部] [🎯 推送当前]

📊 日志 🍪 Cookie ⚙️ 设置 ℹ️ 关于
```

#### 配置页面（域名管理）
```
🍪 CookieSyncer 配置管理

➕ 添加新域名
   [输入框] [添加域名]

📋 域名列表
   [域名概览列表，支持编辑和删除]
```

### 🔧 故障排除

#### 如果扩展无法加载
1. **检查文件完整性**：确保所有文件都在CookieSyncer目录下
2. **重新加载**：移除扩展后重新加载
3. **检查权限**：确保manifest.json权限声明正确

#### 如果功能不工作
1. **检查域名配置**：确保域名已添加且启用
2. **查看日志**：点击"📊 日志"查看详细错误信息
3. **检查网络**：确保能够访问目标网站

#### 如果Cookie获取失败
1. **确认登录状态**：确保在目标网站已登录
2. **检查域名权限**：确保扩展有权限访问该域名
3. **尝试不同策略**：切换续期策略再试

###  安装到Chrome浏览器

#### 方法一：开发者模式安装（推荐）

1. **打开Chrome浏览器**
2. **进入扩展管理页面**：
   - 在地址栏输入：`chrome://extensions/`
   - 或：点击右上角三点菜单 → 更多工具 → 扩展程序

3. **启用开发者模式**：
   - 在扩展程序页面右上角找到"开发者模式"开关
   - 点击开启（变为蓝色）

4. **加载扩展程序**：
   - 点击左上角的"加载已解压的扩展程序"按钮
   - 在文件对话框中选择 `CookieSyncer` 项目文件夹
   - 点击"确定"或"打开"

5. **安装完成**：
   - 扩展程序列表中会出现 "CookieSyncer – 通用 Cookie/TOKEN 推送助手"
   - 确保扩展程序已启用（右侧开关为蓝色）

#### 方法二：打包安装（生产环境）

1. **打包扩展**：
   ```bash
   # 如果要打包成crx文件
   # 在Chrome扩展管理页面点击"打包扩展程序"
   # 选择项目根目录，生成crx文件
   ```

2. **安装crx文件**：
   - 在扩展管理页面拖拽crx文件到页面中
   - 或点击"从文件安装"选择crx文件

### 🔧 配置和使用

#### 1. 首次使用配置

1. **安装完成后**，您会在Chrome工具栏看到CookieSyncer图标（🍪）
2. **点击图标**打开扩展弹窗
3. **点击"⚙️ 设置"**进入配置页面
4. **添加域名**：
   - 在"添加新域名"输入框中输入域名（如：`github.com`）
   - 点击"添加域名"按钮

#### 2. 基本使用流程

```
安装扩展 → 配置域名 → 开始推送 → 查看日志 → 管理Cookie
    ↓        ↓         ↓        ↓         ↓
   ✅      ✅        ✅       ✅        ✅
工具栏图标 选项页面 自动运行 日志页面 Cookie页面
```

#### 3. 日常使用

**自动推送**（后台运行）：
- 扩展会根据配置的频率自动推送Cookie
- 无需手动干预，静默完成续期操作

**手动操作**：
- 点击扩展图标查看当前状态
- 点击"📊 日志"查看推送历史
- 点击"🍪 Cookie"查看所有域名Cookie
- 点击"⚙️ 设置"修改域名配置

### 图标说明

项目目前不包含图标文件，如需美化扩展外观，请准备以下尺寸的 PNG 图标文件并放置在 `icons/` 目录下：

- **16x16** - 扩展工具栏图标（必需）
- **32x32** - Windows 等系统中的图标（推荐）
- **48x48** - 扩展管理页面图标（推荐）
- **128x128** - Chrome Web Store 图标（推荐）

创建图标后，请在 `manifest.json` 中取消注释并正确设置图标路径：

```json
"action": {
    "default_popup": "popup.html",
    "default_title": "CookieSyncer",
    "default_icon": {
        "16": "icons/icon.png",
        "32": "icons/icon.png",
        "48": "icons/icon.png",
        "128": "icons/icon.png"
    }
},
"icons": {
    "16": "icons/icon.png",
    "32": "icons/icon.png",
    "48": "icons/icon.png",
    "128": "icons/icon.png"
}
```

项目提供了 `icons/icon.svg` 文件作为设计参考，您可以使用矢量图形编辑器打开并导出为 PNG 格式。

## 🏗️ 架构演进

### 当前版本 vs 现代化版本

CookieSyncer 提供了两种不同的架构实现：

#### 当前版本 (纯JavaScript) - **推荐使用**
- ✅ **立即可用**：无需构建，直接加载使用
- ✅ **零配置安装**：无需安装Node.js或其他工具
- ✅ **完整功能**：所有功能都已实现并可用
- ✅ **简单直接**：所有代码在一个目录下
- ❌ **类型不安全**：容易出现运行时错误
- ❌ **代码耦合**：功能模块间依赖不清

#### 现代化版本 (TypeScript + 模块化) - **学习参考**
- ✅ **类型安全**：编译时类型检查，减少错误
- ✅ **模块化设计**：清晰的代码组织和职责分离
- ✅ **现代化特性**：使用最新的JavaScript/TypeScript特性
- ✅ **易于维护**：代码结构清晰，易于扩展
- ✅ **开发体验**：智能提示、自动补全、重构支持
- ⚠️ **需要构建**：仅供学习和长期维护参考

### 现代化架构优势

1. **类型安全**
   ```typescript
   // 有类型提示和检查
   function syncDomain(domain: string): Promise<SyncResult> {
       // ...
   }
   ```

2. **模块化设计**
   ```
   src/
   ├── core/          # 核心业务逻辑
   ├── background/    # 后台脚本
   ├── ui/           # 用户界面逻辑
   └── utils/        # 工具函数
   ```

3. **现代JavaScript特性**
   - 异步/等待语法
   - 箭头函数和解构赋值
   - 模块导入导出
   - 类的继承和接口

4. **开发工具支持**
   - TypeScript编译检查
   - ESLint代码规范检查
   - Webpack打包优化
   - 热重载开发体验

### 🚀 现代化开发工作流（可选）

**现代化TypeScript版本仅供学习参考，当前版本无需构建！**

如果您想体验现代化开发，可以运行：

```bash
# 1. 安装依赖（可选）
npm install

# 2. 开发时监听变化并自动构建（可选）
npm run dev

# 3. 生产构建（可选）
npm run build

# 4. 类型检查（可选）
npm run type-check

# 5. 代码规范检查（可选）
npm run lint
```

**💡 提示**：现代化版本适合学习TypeScript和模块化开发，但不影响当前版本的使用。

## ⚙️ 配置指南

### 添加域名

1. 点击扩展图标打开弹窗，或前往扩展管理页面的选项页面
2. 在"添加新域名"表单中输入域名（如：`example.com`）
3. 点击"添加域名"按钮完成添加

### 配置选项

每个域名支持以下配置：

- **启用/禁用**：控制是否参与自动推送
- **推送频率**：设置自动推送间隔（分钟，1-1440）
- **自动续期**：是否在推送时尝试续期 Cookie
- **续期策略**：选择续期失败时的处理策略
  - `fetch`：轻量级 HTTP 请求（推荐）
  - `tab`：后台打开页面
  - `script`：注入脚本交互
- **Cookie字段**：指定需要推送的Cookie字段名，支持多行配置

### 新增功能

#### 📊 推送日志查看
- 点击弹窗中的"📊 日志"按钮打开日志页面
- 查看所有域名的推送历史和详细日志
- 支持按域名、状态、日期筛选日志
- 导出日志数据为JSON格式

#### 🍪 Cookie查看器
- 点击弹窗中的"🍪 Cookie"按钮打开Cookie查看器
- **自动显示所有已配置域名**的Cookie概况，无需手动输入
- **域名列表展示**：每个域名显示启用状态、Cookie数量、推送频率、上次推送状态
- **展开查看详情**：点击域名可以展开查看该域名的所有Cookie
- **实时刷新**：支持单独刷新某个域名的Cookie信息
- **便捷操作**：支持复制Cookie值、查看详情、删除Cookie
- **智能跳转**：可快速跳转到当前页面对应域名的Cookie详情

## 🧪 测试指南

### 基础功能测试

1. **域名管理测试**
   ```bash
   # 1. 打开 options.html 测试配置界面
   # 2. 添加测试域名（如：httpbin.org）
   # 3. 验证域名列表显示和状态更新
   ```

2. **弹窗功能测试**
   ```bash
   # 1. 点击扩展图标打开弹窗
   # 2. 验证域名状态显示
   # 3. 测试手动推送功能
   ```

3. **后台服务测试**
   ```bash
   # 1. 打开扩展后台页面查看控制台日志
   # 2. 等待定时任务触发观察日志输出
   # 3. 检查 Chrome DevTools Application > Cookies
   ```

### 续期策略测试

1. **Fetch 策略测试**
   ```javascript
   // 测试轻量级请求续期
   // 观察 Network 面板中的请求是否带 Cookie
   ```

2. **Tab 策略测试**
   ```javascript
   // 测试后台打开页面
   // 检查是否静默打开标签页后自动关闭
   ```

3. **Script 策略测试**
   ```javascript
   // 测试脚本注入
   // 检查 Console 中是否有注入脚本的日志
   ```

### Cookie 操作测试

1. **Cookie 获取测试**
   ```javascript
   // 1. 配置测试域名
   // 2. 手动触发推送
   // 3. 检查后台日志中的 Cookie 获取情况
   ```

2. **Cookie 过滤测试**
   ```javascript
   // 1. 在域名配置中指定 cookieFields
   // 2. 验证只推送指定字段的 Cookie
   ```

   3. **Cookie 查看器测试**
      ```javascript
      // 1. 点击弹窗中的"🍪 Cookie"按钮
      // 2. 验证自动显示所有已配置域名列表
      // 3. 点击域名展开查看Cookie详情
      // 4. 测试复制、详情查看、删除功能
      // 5. 测试"查看当前页面"跳转功能
      ```

### 日志功能测试

1. **日志记录测试**
   ```javascript
   // 1. 执行域名推送操作
   // 2. 点击弹窗中的"📊 日志"按钮
   // 3. 验证推送操作是否记录在日志中
   ```

2. **日志筛选测试**
   ```javascript
   // 1. 打开日志页面
   // 2. 测试按域名、状态、日期筛选
   // 3. 验证筛选结果是否正确
   ```

3. **日志导出测试**
   ```javascript
   // 1. 在日志页面点击"导出日志"
   // 2. 验证下载的JSON文件内容是否正确
   ```

## 🔍 调试技巧

### 查看日志

1. **弹窗页面调试**：右键弹窗页面 → 检查 → Console
2. **后台页面调试**：扩展管理页面 → CookieSyncer → 检查视图 → Console
3. **选项页面调试**：扩展选项页面 → F12 → Console

### 常见问题

1. **扩展无法加载（图标问题）**
   - 当前项目未包含 PNG 格式图标文件
   - 请准备 16x16、32x32、48x48、128x128 尺寸的 PNG 图标
   - 或参考 `icons/icon.svg` 文件自行创建

2. **Cookie查看器操作失败**
   - 确保在扩展选项页面中已添加并启用了目标域名
   - 检查浏览器是否已授予 Cookie 访问权限
   - 确认目标网站已登录且有有效 Cookie
   - 点击"查看所有域名Cookie"按钮自动加载所有配置的域名

3. **权限不足**
   - 确认 manifest.json 中声明了必要权限
   - 检查域名是否支持跨域请求

4. **定时任务不执行**
   - 检查后台服务是否正常初始化
   - 确认域名已启用且配置正确

5. **Cookie 获取失败**
   - 确认网站已登录且有有效 Cookie
   - 检查域名配置是否正确

## 📋 功能清单

- ✅ 域名管理（增删改查）
- ✅ 多层续期策略（fetch/tab/script）
- ✅ 定时任务调度
- ✅ Cookie 获取和过滤
- ✅ Cookie字段选择配置
- ✅ 灵活的推送频率设置
- ✅ 推送日志记录和显示（支持筛选和导出）
- ✅ Cookie查看器和管理工具（域名列表自动展示）
- ✅ 用户界面（弹窗、选项、日志、Cookie页面）
- ✅ 消息通信机制
- ✅ 错误处理和日志
- ✅ 数据统计和摘要

## 🔮 未来规划

### 功能增强
- [ ] 加密存储配置信息
- [ ] 跨设备推送配置
- [ ] 批量导入导出配置
- [ ] 高级续期策略定制
- [ ] 浏览器兼容性扩展（Firefox）
- [ ] Cookie自动备份和恢复
- [ ] 智能续期策略推荐
- [ ] 多标签页并发处理优化

### 架构现代化
- [ ] 完成TypeScript重写
- [ ] 实现完整的模块化架构
- [ ] 添加单元测试和集成测试
- [ ] CI/CD流水线构建
- [ ] 代码覆盖率报告
- [ ] 性能监控和分析
- [ ] 国际化支持（i18n）
- [ ] 无障碍访问支持（a11y）

## 📄 许可证

本项目仅供学习和研究使用，请遵守相关法律法规和网站的使用条款。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

### ⚡ 3分钟快速上手

#### 第1分钟：安装扩展
```bash
1. 打开 chrome://extensions/
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择CookieSyncer文件夹
5. ✅ 安装完成！
```

#### 第2分钟：添加域名
```bash
1. 点击扩展图标（🍪）
2. 点击"⚙️ 设置"
3. 输入域名：github.com
4. 点击"添加域名"
5. 点击"编辑"设置频率为60分钟
6. ✅ 配置完成！
```

#### 第3分钟：开始使用
```bash
1. 点击扩展图标查看状态
2. 点击"📊 日志"查看推送历史
3. 点击"🍪 Cookie"查看域名Cookie
4. 等待自动推送开始工作
5. ✅ 开始享受自动化服务！
```

**🎉 恭喜！无需安装Node.js、无需运行构建命令、无需配置环境，开箱即用！**

### 🔧 功能验证清单

完成安装后，请验证以下功能是否正常：

#### ✅ 基本功能检查
- [ ] 扩展图标显示正常（工具栏有🍪图标）
- [ ] 点击图标能打开弹窗界面
- [ ] 弹窗显示"当前页面"和功能按钮

#### ✅ 配置功能检查
- [ ] 点击"⚙️ 设置"能打开配置页面
- [ ] 能成功添加域名（如：github.com）
- [ ] 域名列表显示正常
- [ ] 能编辑域名配置（频率、策略等）

#### ✅ Cookie查看器检查
- [ ] 点击"🍪 Cookie"打开查看器页面
- [ ] **自动显示所有已配置域名**（重点检查！）
- [ ] 每个域名显示Cookie数量和状态
- [ ] 点击域名能展开查看Cookie详情

#### ✅ 日志功能检查
- [ ] 点击"📊 日志"打开日志页面
- [ ] 执行推送操作后有日志记录
- [ ] 日志显示推送状态和时间

### 🚨 常见问题快速解决

| 问题现象 | 快速解决方案 |
|---------|-------------|
| **Cookie数量显示0** | 1. 确认域名已添加并启用<br>2. 点击"查看所有域名Cookie"按钮<br>3. 检查是否能访问目标网站 |
| **频率无法修改** | 1. 点击域名后的"编辑"按钮<br>2. 修改推送频率后点击"保存配置"<br>3. 等待几秒后刷新页面验证 |
| **扩展图标不显示** | 1. 确认扩展已正确加载<br>2. 检查是否启用了扩展<br>3. 刷新扩展管理页面 |
| **日志为空** | 1. 等待自动推送执行<br>2. 或手动点击"推送全部"按钮<br>3. 查看是否有错误日志 |

**💡 提示**：初次使用建议从简单的域名开始测试，逐步熟悉各项功能。如遇到问题，请查看浏览器控制台日志获取详细错误信息。

### 🎨 自定义图标（可选）

当前扩展使用SVG图标，如需美化外观：

1. **准备PNG图标**：创建16x16、32x32、48x48、128x128像素的PNG图标
2. **放置图标**：将图标文件放入`icons/`目录，命名为`icon.png`
3. **更新配置**：在`manifest.json`中取消注释图标配置部分
4. **重新加载**：移除扩展后重新加载以应用新图标

### 📞 技术支持

如果遇到问题，请：

1. **查看日志**：点击"📊 日志"查看详细错误信息
2. **检查配置**：确认域名已正确添加和启用
3. **测试网络**：确保能够正常访问目标网站
4. **重启扩展**：移除后重新加载扩展程序
